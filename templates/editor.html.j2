{% extends "base.html.j2" %}

{% block head %}
        <title>Audio Center</title>
        <style>
            #progress {
                background-color: blue;
                opacity: 0.5;
                border-radius: 5px;
            }
        </style>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script src="static/progress.js"></script>
        <script>
            $(document).ready(function(){
                $("#hide").click(function(){
                    $("#bar").hide();
                });
                $(".show").click(function(){
                    $("#bar").show();
                });
                $(".show2").click(function(){
                    $("#bar2").show();
                });
            });
        </script>
{% endblock %}

{% block body %}        
    <div class="">
        <br><br><br>
        <div id="bgtext">
            <div class="fadein">
                <h1>AudioCenter Editor</h1>
                <form method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="form" value="1">
                    <input class="btn" type="file" name="file">
                    <input class="btn btn-primary" type="submit" name="submit" value="Upload">
                </form>
                <h5>Current File: {{fn}}</h5>
                {%if out.type == "detect"%}
                    <h3>{{out.output.title}}</h3>
                    <h4>{{out.output.artist}}</h4>
                    <img src="{{out.output.image}}">
                    <br><br><br>
                    <h5>{{out.output.lyrics}}</h5>
                {%elif out.type == "files"%}
                {%for i in out.output%}
                    {%set ffn = i.split('/')%}
                    <h3>Download: <a href="{{i}}" download>{{ffn[ffn|length-1]}}</a></h3>
                {%endfor%}
                {%endif%}
                <div id="waveform"></div>
                <form method="POST" enctype="multipart/form-data">
                    <div id="hiddenKeyChange">
                        <h5>Change Key</h5>
                        <input type="range" name="steps" min="-10" max="10" step="1" oninput="document.getElementById('keyValue').innerHTML = this.value">
                        <input class="btn btn-primary" type="submit" name="keychange" value="Change">
                        <br><h5>Steps: <output id="keyValue">0</output></h5>
                    </div>

                    <div id="hiddenSpeedChange">
                        <h5>Change Speed Factor</h5>
                        <input type="range" name="factorSpeed" min="0.1" max="4" step="0.1" oninput="document.getElementById('speedValue').innerHTML = this.value">
                        <input class="btn btn-primary" type="submit" name="speedchange" value="Change">
                        <br><h5>Steps: <output id="speedValue">2</output></h5>
                    </div>

                    
                    <div id="hiddenAmplify">
                        <h5>Change Amplify Factor</h5>
                        <input type="range" name="factorAmp" min="0.1" max="4" step="0.1" oninput="document.getElementById('ampValue').innerHTML = this.value">
                        <input class="btn btn-primary" type="submit" name="amplify" value="Change">
                        <br><h5>Steps: <output id="ampValue">2</output></h5>
                    </div>

                    <input type="hidden" name="form" value="2">
                    <input class="btn btn-primary" type="submit" name="convert" value="Convert to WAV">
                    <input class="btn btn-primary" type="submit" name="detect" value="Detect Song">
                    <input class="btn btn-primary" type="button" name="key" value="Key Change" onclick="showKey()">
                    <input class="btn btn-primary" type="button" name="amp" value="Amplify" onclick="showAmp()">
                    <input id="clickme" class="show show2 btn btn-primary" onclick="alert(400); this.onclick=null; showBar(); hideBar(400);" data-bs-toggle="modal" data-bs-target="#exampleModal" type="submit" name="split" value="Split">
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                        <div class="modal-body">
                            <div id="bar" class="counter" style="display:none">0</div>
                            <div id="bar2" class="progressbar" style="display:none">
                                <span class="progress"></span>
                            </div>
                            <div id="text" style="display:none">
                                <p>All done!</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                        </div>
                    </div>
                    </div>
                    <input class="btn btn-primary" type="submit" name="waveform" value="Display Waveform">
                    <input class="btn btn-primary" type="hidden" name="newdata" id="elbruh">
                    <input class="btn btn-primary" type="submit" name="cut" value="Cut">
                    <input class="btn btn-primary" type="button" name="speed" value="Speed Change" onclick="showSpeed()">
                </form>
            </div>
        </div>
    </div>
    <script>
        var wavesurfer = WaveSurfer.create({
            container: "#waveform",
            waveColor: "violet",
            progressColor: "purple",
            plugins: [
            WaveSurfer.playhead.create({
                returnOnPause: true,
                moveOnSeek: true,
                draw: true
            })
        ]
        });
        wavesurfer.load("{{fn}}")
        $("#hiddenKeyChange").toggle();
        $("#hiddenSpeedChange").toggle();
        $("#hiddenAmplify").toggle();
        
        function showKey() {
            $("#hiddenKeyChange").toggle();
            if($("#hiddenSpeedChange").is(":visible")){
                $("#hiddenSpeedChange").toggle();
                }
            if($("#hiddenAmplify").is(":visible")){
                $("#hiddenAmplify").toggle();
                }
            }

        function showSpeed() {
            $("#hiddenSpeedChange").toggle();

            if($("#hiddenKeyChange").is(":visible")){
                $("#hiddenKeyChange").toggle();
                }
            if($("#hiddenAmplify").is(":visible")){
                $("#hiddenAmplify").toggle();
                }
                
            }     
            
        function showAmp() {
            $("#hiddenAmplify").toggle();

            if($("#hiddenKeyChange").is(":visible")){
                $("#hiddenKeyChange").toggle();
                }
            if($("#hiddenSpeedChange").is(":visible")){
                $("#hiddenSpeedChange").toggle();
                }    
                
            }
    </script>
{% endblock %}